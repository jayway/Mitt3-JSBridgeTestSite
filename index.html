<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        body * {
            display: block;
            margin-bottom: 1em;
        }
    </style>
    <script>
        
    var isIOS = (window.webkit !== undefined);

    // pretend we finish loading AJAX requests after 1500ms
    setTimeout(didFinishLoading, 1500);
    
    function didFinishLoading() {
        if (isIOS) {
            window.webkit.messageHandlers.didFinishLoading.postMessage("");
        } else {
            window.my3Bridge.didFinishLoading();
        }
        
        document.getElementById("didFinishLoading").textContent = "didFinishLoading() was triggered.";
    }
    function trackUsabilla() {
        if (isIOS) {
            window.webkit.messageHandlers.trackUsabillaEvent.postMessage("fooBar");
        } else {
            window.my3Bridge.trackUsabillaEvent("fooBar");
        }
    }
    function setUsabillaCustomVariables() {
        var variables = { "foo": "bar", "hello": 123 };
        
        if (isIOS) {
            window.webkit.messageHandlers.setUsabillaCustomVariables.postMessage(variables);
        } else {
            // Android JS bridge can only take method arguments as primitive types (strings, numbers, booleans), not objects.
            // Workaround is to send JS object as a JSON string.
            // More info: https://stackoverflow.com/a/2251691
            window.my3Bridge.setUsabillaCustomVariables(JSON.stringify(variables));
        }
    }
    function loadUsabillaForm() {
        if (isIOS) {
            window.webkit.messageHandlers.loadUsabillaForm.postMessage("587344e08769278408531e64");
        } else {
            window.my3Bridge.loadUsabillaForm("587344e08769278408531e64");
        }
    }
    function requestPush() {
        if (isIOS) {
            // Not implemented
            //
            // var msg = { method: "doRequestPushNotifications" }
            // window.webkit.messageHandlers.fooBar.postMessage(JSON.stringify(msg));
        } else {
            window.my3Bridge.doRequestPushNotifications();
        }
    }

    function setLocale() {
        if (isIOS) {
            window.webkit.messageHandlers.setLocale.postMessage("se");
        } else {
            window.my3Bridge.setLocale("se");
        }
    }

    window.my3BridgeCallbacks = {
        didReceivePushToken: function(token) {
            document.getElementById("pushToken").textContent = "Received push token: " + token;
        },
    };


    </script>
</head>
<body>

    <h1>Test Javascript bridge</h1>

    <p id="didFinishLoading"></p>

    <button type="button" onclick="trackUsabilla()">Track Usabilla event</button>
    
    <button type="button" onclick="setUsabillaCustomVariables()">Set Usabilla Custom Variables</button>

    <button type="button" onclick="loadUsabillaForm()">Load Usabilla Form</button>

    <button type="button" onclick="requestPush()">Request push notifications</button>

    <button type="button" onclick="setLocale()">Set locale to se</button>

    <p id="pushToken"></p>
</body>
</html>
